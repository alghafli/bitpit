<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Additional Tuning &mdash; bitpit 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="bitpit 1.0.0 documentation" href="index.html" />
    <link rel="next" title="Elegant Output" href="elegant-output.html" />
    <link rel="prev" title="Specify Path and Rate Limit" href="specify-path-and-rate-limit.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="additional-tuning">
<h1>Additional Tuning<a class="headerlink" href="#additional-tuning" title="Permalink to this headline">¶</a></h1>
<p>Now we have most of our work done. We are going to look into a few minor
additional things we can do to modify our downloader behaviour.</p>
<div class="section" id="connection-timeout">
<h2>Connection Timeout<a class="headerlink" href="#connection-timeout" title="Permalink to this headline">¶</a></h2>
<p>We can change the connection timeout settings by giving the <code class="docutils literal"><span class="pre">timeout</span></code> argument
to <code class="docutils literal"><span class="pre">Downloader.__init__()</span></code>. The default value is 10 seconds. That is relatively
small. Let&#8217;s make it 1 minute:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">dl</span> <span class="o">=</span> <span class="n">bitpit</span><span class="o">.</span><span class="n">Downloader</span><span class="p">(</span>
        <span class="n">url</span><span class="p">,</span>
        <span class="n">path</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;Desktop&#39;</span> <span class="o">/</span> <span class="s1">&#39;logo.png&#39;</span><span class="p">,</span>
        <span class="n">restart_wait</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">rate_limit</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="chunk-size">
<h2>Chunk Size<a class="headerlink" href="#chunk-size" title="Permalink to this headline">¶</a></h2>
<p>We can also supply the download <code class="docutils literal"><span class="pre">chunk_size</span></code> to <code class="docutils literal"><span class="pre">Downloader.__init__()</span></code>.
The chunk size is the maximum number of bytes to download in a single network
read operation. You do not really need to change this at all but just in case
you want to change it. Having very low or very high values may slightly affect
download speed. There is no hard rule to figure out the best other than trying.
In my computer, the default value worked best. The default value is 4 KB. For
practice, let&#8217;s change it to 1 KB:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">dl</span> <span class="o">=</span> <span class="n">bitpit</span><span class="o">.</span><span class="n">Downloader</span><span class="p">(</span>
        <span class="n">url</span><span class="p">,</span>
        <span class="n">path</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;Desktop&#39;</span> <span class="o">/</span> <span class="s1">&#39;logo.png&#39;</span><span class="p">,</span>
        <span class="n">restart_wait</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">rate_limit</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
        <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1024</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">chunk_size</span></code> cannot be greater than <code class="docutils literal"><span class="pre">rate_limit</span></code>. If it is greater,
<cite>bitpit</cite> will force it to be equal to <code class="docutils literal"><span class="pre">rate_limit</span></code>.</p>
<p>Here is our program so far:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bitpit</span>
<span class="kn">import</span> <span class="nn">pathlib</span>

<span class="k">def</span> <span class="nf">on_size_changed</span><span class="p">(</span><span class="n">downloader</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;The file size is&#39;</span><span class="p">,</span> <span class="n">downloader</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">on_speed_changed</span><span class="p">(</span><span class="n">downloader</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;The speed is&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">downloader</span><span class="o">.</span><span class="n">human_speed</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">on_state_changed</span><span class="p">(</span><span class="n">downloader</span><span class="p">,</span> <span class="n">old_state</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;The state changed to:&#39;</span><span class="p">,</span> <span class="n">downloader</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>

<span class="c1">#will download this</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.python.org/static/img/python-logo.png&#39;</span>

<span class="c1">#this is our downloader</span>
<span class="n">dl</span> <span class="o">=</span> <span class="n">bitpit</span><span class="o">.</span><span class="n">Downloader</span><span class="p">(</span>
        <span class="n">url</span><span class="p">,</span>
        <span class="n">path</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;Desktop&#39;</span> <span class="o">/</span> <span class="s1">&#39;logo.png&#39;</span><span class="p">,</span>
        <span class="n">restart_wait</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">rate_limit</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
        <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1024</span>
    <span class="p">)</span>

<span class="c1">#listen to signals</span>
<span class="c1">#print size as soon as it is known</span>
<span class="n">dl</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="s1">&#39;size-changed&#39;</span><span class="p">,</span> <span class="n">on_size_changed</span><span class="p">)</span>

<span class="c1">#print speed periodically</span>
<span class="n">dl</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="s1">&#39;speed-changed&#39;</span><span class="p">,</span> <span class="n">on_speed_changed</span><span class="p">)</span>

<span class="c1">#print state</span>
<span class="n">dl</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="s1">&#39;state-changed&#39;</span><span class="p">,</span> <span class="n">on_state_changed</span><span class="p">)</span>

<span class="c1">#start downloading and tell user download has started.</span>
<span class="n">dl</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Download has started.&#39;</span><span class="p">)</span>

<span class="c1">#end of the main thread</span>
</pre></div>
</div>
<p>Now we have only one thing left to do. If you have noticed, our output is ugly.</p>
<p>In <a class="reference internal" href="elegant-output.html"><em>Elegant Output</em></a> we are going to make it pretty. We will also introduce some
useful things in <cite>bitpit</cite>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Additional Tuning</a><ul>
<li><a class="reference internal" href="#connection-timeout">Connection Timeout</a></li>
<li><a class="reference internal" href="#chunk-size">Chunk Size</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="specify-path-and-rate-limit.html" title="previous chapter">Specify Path and Rate Limit</a></li>
      <li>Next: <a href="elegant-output.html" title="next chapter">Elegant Output</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/additional-tuning.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Mohammad Alghafli.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
      |
      <a href="_sources/additional-tuning.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>